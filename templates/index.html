<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>baileys</title>
    
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="/static/css/index.css" />
</head>
<body>
<div class="container-fluid">
    <!-- 页头 -->
    <div class="row">
        <div class="col-md-10">
            <div class="page-header">
                <h1>Baileys<small> 从数据库到代码的自动生成工具</small></h1>
            </div>
        </div>
        <!-- 功能按钮 -->
        <div class="col-md-1">
            <div class="page-header">
                <button type="button" class="btn btn-success" onclick="gen()"> 点击生成 </button>
            </div>
        </div>
    </div>


    <!-- 模板列表 -->
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-body">
                    <table class="table">
                        <thead>
                            <tr>
                                <th><button type="button" class="btn-xs btn-link" onclick="checkAllTpl()">全选/全不选</button></th>
                                <th>模板名称</th>
                                <th>生成路径</th>
                                <th>输出文件名称参考</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{range $i,$e := .everyTplList}}
                                <tr class="info">
                                    <td><input name="tplCheckbox" lang="{{ $e.Tpl.Name }}" type="checkbox" checked="checked"></td>
                                    <td>{{ $e.Tpl.Name }}</td>
                                    <td>{{ $e.OutputPath }}</td>
                                    <td>xxx{{ $e.FilenameSuffix }}</td>
                                </tr>
                            {{end}}
                            {{range $i,$e := .oneTplList}}
                                <tr class="success">
                                    <td><input name="tplCheckbox" lang="{{ $e.Tpl.Name }}" type="checkbox" checked="checked"></td>
                                    <td>{{ $e.Tpl.Name }}</td>
                                    <td>{{ $e.OutputPath }}</td>
                                    <td>{{ $e.FilenameSuffix }}</td>
                                </tr>
                            {{end}}
                        </tbody>
                        
                    </table>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-body">
                    <table class="table">
                        <thead>
                        <tr>
                            <th><button type="button" class="btn-xs btn-link" onclick="checkAllTab()">全选/全不选</button></th>
                            <th>大驼峰命名</th>
                            <th>小驼峰命名</th>
                            <th>下划线命名</th>
                            <th>注释</th>
                        </tr>
                        </thead>
                        <tbody>
                            {{range $i,$e := .tableData}}
                                <tr>
                                    <td><input name="tabCheckbox" lang="{{ $e.UpperCamelName }}" type="checkbox" checked="checked"></td>
                                    <td>{{ $e.UpperCamelName }}</td>
                                    <td>{{ $e.LowerCamelName }}</td>
                                    <td>{{ $e.UnderlineName }}</td>
                                    <td>{{ $e.Comment }}</td>
                                </tr>
                            {{end}}
                        </tbody>

                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="loadingModal" style="pointer-events: none">
    <div style="width: 500px;height:20px; z-index: 20000; position: absolute; text-align: center; left: 50%; top: 50%;margin-left:-300px;margin-top:-10px">
        <div class="progress progress-striped active" style="margin-bottom: 0; width: 100%;">
            <div class="progress-bar" style="width: 100%;"></div>
        </div>
        <h1 style="color:black"> <strong>正在生成中...请勿刷新页面</strong> </h1>
    </div>
</div>

<script>
    
    var isTabCheck = false
    function checkAllTab() {
        var tabCheckboxList = document.getElementsByName("tabCheckbox");
        for (i = 0; i < tabCheckboxList.length; i++) {
            tabCheckboxList[i].checked = isTabCheck
        }
        isTabCheck = !isTabCheck
    }
    
    var isTplCheck = false;
    function checkAllTpl() {
        var tplCheckboxList = document.getElementsByName("tplCheckbox");
        for (i = 0; i < tplCheckboxList.length; i++) {
            tplCheckboxList[i].checked = isTplCheck
        }
        isTplCheck = !isTplCheck
    }
    
    function gen() {
        $("#loadingModal").modal('show');
        var tplCheckboxList = document.getElementsByName("tplCheckbox");
        var checkTplArr = [];
        var index = 0;
        for (i = 0; i < tplCheckboxList.length; i++) {
            if (tplCheckboxList[i].checked) {
                checkTplArr[index++] = "\"" + tplCheckboxList[i].lang + "\"";
            }
        }
        var tabCheckboxList = document.getElementsByName("tabCheckbox");
        var checkTabArr = [];
        index = 0;
        for (i = 0; i < tabCheckboxList.length; i++) {
            if (tabCheckboxList[i].checked) {
                checkTabArr[index++] = "\"" + tabCheckboxList[i].lang + "\"";
            }
        }

        $.ajax({
            url: '/gen',
            type: 'post',
            dataType: 'json',
            contentType: 'application/json',
            data: "{\"gen_tpl_name_list\":[" + checkTplArr.toString() + "], \"gen_table_name_list\":[" + checkTabArr.toString() + "]}",
            success: function(result){
                $("#loadingModal").modal('hide');
                alert(result.message)
            },error: function (e) {
                $("#loadingModal").modal('hide');
                alert(e.statusText)
            }
        })
    }
</script>
</body>
</html>